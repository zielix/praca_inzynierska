import pandas as pd
from datetime import datetime

# Zakładam, że masz df z kolumną YearMonth
# df = pd.read_csv('twoj_plik.csv')  # lub inny sposób wczytania danych

# Pobierz aktualną datę
current_date = datetime.now()
current_year = current_date.year
current_month = current_date.month

# Konwersja YearMonth na format datetime dla łatwiejszych obliczeń
df['YearMonth_dt'] = pd.to_datetime(df['YearMonth'], format='%Y%m')

# Aktualna data jako pierwszy dzień miesiąca
current_yearmonth = pd.Timestamp(year=current_year, month=current_month, day=1)

# Obliczanie flag czasowych
df['CYTD'] = (df['YearMonth_dt'].dt.year == current_year).astype(int)
df['P1M'] = (df['YearMonth_dt'] == (current_yearmonth - pd.DateOffset(months=1))).astype(int)
df['P3M'] = (df['YearMonth_dt'] >= (current_yearmonth - pd.DateOffset(months=3))) & \
            (df['YearMonth_dt'] < current_yearmonth)
df['P3M'] = df['P3M'].astype(int)
df['P6M'] = (df['YearMonth_dt'] >= (current_yearmonth - pd.DateOffset(months=6))) & \
            (df['YearMonth_dt'] < current_yearmonth)
df['P6M'] = df['P6M'].astype(int)
df['P12M'] = (df['YearMonth_dt'] >= (current_yearmonth - pd.DateOffset(months=12))) & \
             (df['YearMonth_dt'] < current_yearmonth)
df['P12M'] = df['P12M'].astype(int)

# Obliczanie FY (rok fiskalny zaczyna się w lipcu)
def get_fiscal_year(row):
    year = row['YearMonth_dt'].year
    month = row['YearMonth_dt'].month
    
    # Określenie roku fiskalnego
    if month >= 7:  # Lipiec lub później
        fy_start = year
        fy_end = year + 1
    else:  # Przed lipcem
        fy_start = year - 1
        fy_end = year
    
    # Określenie czy to obecny rok fiskalny
    if current_month >= 7:
        current_fy_start = current_year
    else:
        current_fy_start = current_year - 1
    
    # Jeśli to obecny rok fiskalny
    if fy_start == current_fy_start:
        return 'FYTD'
    else:
        return f'FY {str(fy_start)[2:]}/{str(fy_end)[2:]}'

df['FY'] = df.apply(get_fiscal_year, axis=1)

# Usuń kolumnę pomocniczą jeśli nie jest potrzebna
# df = df.drop('YearMonth_dt', axis=1)

print(df.head())
